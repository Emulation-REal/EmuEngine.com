<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EmuEngine - The Web Engine</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
    background: #fff;
    color: #202124;
  }
  header {
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
    font-weight: 700;
    font-size: 24px;
    color: #4285f4; /* Google blue */
    user-select: none;
  }
  header span.emuengine {
    font-weight: 700;
    font-size: 24px;
  }
  /* Tab bar */
  #tab-bar {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #ddd;
    height: 38px;
    align-items: center;
    padding: 0 10px;
    overflow-x: auto;
    scrollbar-width: thin;
  }
  #tab-bar::-webkit-scrollbar {
    height: 6px;
  }
  #tab-bar::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
  }
  .tab {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    margin-right: 4px;
    background: #e8e8e8;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    font-size: 14px;
    color: #202124;
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
    border: 1px solid #ccc;
    border-bottom: none;
  }
  .tab.active {
    background: #fff;
    font-weight: 700;
    border-color: #4285f4;
    color: #4285f4;
  }
  .tab .close-btn {
    margin-left: 8px;
    font-weight: 700;
    color: #666;
    cursor: pointer;
    user-select: none;
  }
  .tab .close-btn:hover {
    color: #f44336;
  }
  #add-tab-btn {
    font-size: 20px;
    color: #4285f4;
    cursor: pointer;
    padding: 0 8px;
    user-select: none;
  }
  #add-tab-btn:hover {
    background: #e8f0fe;
    border-radius: 4px;
  }
  /* Address bar */
  #address-bar-container {
    display: flex;
    padding: 12px 20px;
    border-bottom: 1px solid #eee;
    background: #fff;
  }
  #address-bar {
    flex: 1;
    font-size: 16px;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 24px;
    outline: none;
    transition: border-color 0.3s;
  }
  #address-bar:focus {
    border-color: #4285f4;
    box-shadow: 0 0 8px #a8c0ff;
  }
  #go-btn {
    margin-left: 12px;
    background: #4285f4;
    border: none;
    color: white;
    font-weight: 700;
    padding: 10px 20px;
    border-radius: 24px;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  #go-btn:hover {
    background: #3367d6;
  }
  /* Iframe container */
  #iframe-container {
    flex-grow: 1;
    height: calc(100vh - 138px);
    background: #fff;
    position: relative;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  /* Flex container for main page */
  #main-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
</style>
</head>
<body>
  <div id="main-container">
    <header>
      <span class="emuengine">EmuEngine</span>.com
    </header>

    <div id="tab-bar" role="tablist" aria-label="Browser tabs">
      <!-- Tabs inserted dynamically here -->
      <div id="add-tab-btn" title="New Tab" role="button" tabindex="0">+</div>
    </div>

    <div id="address-bar-container">
      <input type="text" id="address-bar" aria-label="Address bar" placeholder="Search Google or enter URL" />
      <button id="go-btn" aria-label="Go">Go</button>
    </div>

    <div id="iframe-container">
      <!-- Iframes go here -->
    </div>
  </div>

<script>
  (() => {
    const tabBar = document.getElementById('tab-bar');
    const addTabBtn = document.getElementById('add-tab-btn');
    const addressBar = document.getElementById('address-bar');
    const goBtn = document.getElementById('go-btn');
    const iframeContainer = document.getElementById('iframe-container');

    let tabs = [];
    let activeTabId = null;

    // Create new tab object
    function createTab(url = 'https://www.google.com') {
      const id = 'tab-' + Math.random().toString(36).substr(2, 9);
      return {
        id,
        url,
        title: 'New Tab',
        iframe: null,
        tabElement: null,
      };
    }

    // Render tabs in tab bar
    function renderTabs() {
      // Clear all except addTabBtn
      [...tabBar.querySelectorAll('.tab')].forEach(el => el.remove());

      for (const tab of tabs) {
        const tabEl = document.createElement('div');
        tabEl.classList.add('tab');
        if (tab.id === activeTabId) tabEl.classList.add('active');
        tabEl.setAttribute('role', 'tab');
        tabEl.setAttribute('aria-selected', tab.id === activeTabId ? 'true' : 'false');
        tabEl.setAttribute('tabindex', tab.id === activeTabId ? '0' : '-1');
        tabEl.textContent = tab.title || tab.url;
        
        // Close button
        const closeBtn = document.createElement('span');
        closeBtn.textContent = 'Ã—';
        closeBtn.className = 'close-btn';
        closeBtn.title = 'Close tab';
        closeBtn.setAttribute('role', 'button');
        closeBtn.setAttribute('tabindex', '0');
        closeBtn.onclick = (e) => {
          e.stopPropagation();
          closeTab(tab.id);
        };
        closeBtn.onkeydown = e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            closeTab(tab.id);
          }
        };
        tabEl.appendChild(closeBtn);

        tabEl.onclick = () => {
          switchTab(tab.id);
        };
        tabEl.onkeydown = e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            switchTab(tab.id);
          }
        };

        tabBar.insertBefore(tabEl, addTabBtn);
        tab.tabElement = tabEl;
      }
    }

    // Switch active tab
    function switchTab(id) {
      if (activeTabId === id) return;
      const oldTab = tabs.find(t => t.id === activeTabId);
      if (oldTab && oldTab.iframe) oldTab.iframe.style.display = 'none';

      activeTabId = id;
      const newTab = tabs.find(t => t.id === id);
      if (!newTab) return;

      if (!newTab.iframe) {
        // Create iframe
        const iframe = document.createElement('iframe');
        iframe.src = newTab.url;
        iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups'); 
        // Note: allow-same-origin may restrict some sites from working properly, but needed for more features

        iframe.onload = () => {
          // Try to get the page title from iframe (only works if same origin)
          try {
            let title = iframe.contentDocument.title;
            if (title) {
              newTab.title = title;
              if (newTab.tabElement) newTab.tabElement.childNodes[0].nodeValue = title;
            }
          } catch (e) {
            // Cross-origin, cannot access title
          }
        };

        iframeContainer.appendChild(iframe);
        newTab.iframe = iframe;
      }
      newTab.iframe.style.display = 'block';

      renderTabs();
      addressBar.value = newTab.url;
      addressBar.focus();
    }

    // Close tab
    function closeTab(id) {
      const index = tabs.findIndex(t => t.id === id);
      if (index === -1) return;

      // Remove iframe if exists
      if (tabs[index].iframe) {
        iframeContainer.removeChild(tabs[index].iframe);
      }
      tabs.splice(index, 1);

      // If closed tab was active, switch to another tab
      if (activeTabId === id) {
        if (tabs.length > 0) {
          const newActiveIndex = Math.min(index, tabs.length - 1);
          switchTab(tabs[newActiveIndex].id);
        } else {
          // No tabs left, create a new one
          const newTab = createTab();
          tabs.push(newTab);
          switchTab(newTab.id);
        }
      } else {
        renderTabs();
      }
    }

    // Normalize URL: if no scheme, add https://
    function normalizeUrl(input) {
      input = input.trim();
      // If looks like search query: spaces, no dot, or common search words
      if (!input.includes('.') || input.match(/\s/)) {
        // Treat as Google search query
        return 'https://www.google.com/search?q=' + encodeURIComponent(input);
      }

      // If no scheme, add https
      if (!/^https?:\/\//i.test(input)) {
        input = 'https://' + input;
      }
      return input;
    }

    // Navigate current tab
    function navigateCurrentTab(input) {
      if (!activeTabId) return;
      const tab = tabs.find(t => t.id === activeTabId);
      if (!tab) return;

      const url = normalizeUrl(input);
      tab.url = url;
      if (tab.iframe) {
        tab.iframe.src = url;
      }
      addressBar.value = url;
      tab.title = url;
      renderTabs();
    }

    // Add new tab and switch
    function addNewTab(url) {
      const tab = createTab(url);
      tabs.push(tab);
      switchTab(tab.id);
    }

    // Add initial tab
    addNewTab('https://www.google.com');

    // Handlers
    addTabBtn.onclick = () => {
      addNewTab('https://www.google.com');
    };
    addTabBtn.onkeydown = e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        addNewTab('https://www.google.com');
      }
    };

    goBtn.onclick = () => {
      navigateCurrentTab(addressBar.value);
    };
    addressBar.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        navigateCurrentTab(addressBar.value);
      }
    });

  })();
</script>
</body>
</html>
